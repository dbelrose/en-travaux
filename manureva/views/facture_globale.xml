<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <record id="facture_globale_form_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.form</field>
            <field name="model">manureva.facture_globale</field>
            <field name="arch" type="xml">
                <form create="0" edit="0" delete="0" string="Facture globale">
                    <sheet>
                        <group>
                            <group string="Entete">
                                <field name="annee"/>
                                <field name="mois"/>
                                <field name="usager"/>
                                <field name="nom_aerodrome"/>
                                <field name="type_aeronef_code"/>
                            </group>
                            <group string="Redevances">
                                <field name="atterissage" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="passagers" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="balisage" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <separator string="Total"/>
                                <field name="montant_total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="facture_globale_tree_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.tree</field>
            <field name="model">manureva.facture_globale</field>
            <field name="arch" type="xml">
                <tree create="false" string="Facture globale" expand="1" >
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="code_usager" invisible="1"/>
                    <field name="usager"/>
                    <field name="code_aerodrome" invisible="1"/>
                    <field name="nom_aerodrome"/>
                    <field name="type_aeronef_code"/>
                    <field name="se_bp" invisible="1"/>
                    <field name="se_cp" invisible="1"/>
                    <field name="se_commune" invisible="1"/>
                    <field name="ile" invisible="1"/>
                    <field name="pays" invisible="1"/>
                    <field name="telephone" invisible="1"/>
                    <field name="fax" invisible="1"/>
                    <field name="min" invisible="1"/>
                    <field name="ser" invisible="1"/>
                    <field name="etmi" invisible="1"/>
                    <field name="etse" invisible="1"/>
                    <field name="bureau" invisible="1"/>
                    <field name="service" invisible="1"/>
                    <field name="ministere" invisible="1"/>
                    <field name="rue" invisible="1"/>
                    <field name="rue2" invisible="1"/>
                    <field name="cp" invisible="1"/>
                    <field name="commune" invisible="1"/>
                    <field name="usager_id" invisible="1"/>
                    <field name="atterissage" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="passagers" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="balisage" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="montant_total" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="taux_normal" invisible="1"/>
                    <field name="taux_reduit" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="facture_globale_search_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.search</field>
            <field name="model">manureva.facture_globale</field>    <!--chanps de recherche-->
            <field name="arch" type="xml">
                <search string="Facture globale">
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="usager"/>
                    <field name="code_usager"/>
                    <field name="nom_aerodrome"/>
                    <field name="code_aerodrome"/>
                    <field name="type_aeronef_code"/>
                    <separator/>
                    <filter name="annee_en_cours"
                            string="Année calendaire en cours"
                            domain="[('annee', '=', context_today().strftime('%Y'))]" />    <!--calcule des dates-->
                    <filter name="annee_precedente"
                            string="Année calendaire précédente"
                            domain="[('annee', '=', (context_today() + relativedelta(years=-1)).strftime('%Y'))]" />
                    <filter name="annee_glissante"
                            string="Année glissante"
                            domain="[('date_debut', '&gt;=', (context_today() - datetime.timedelta(days=365)).strftime('%%Y-%%m-%%d'))]"/>
                    <group expand="1" string="Group By">
                        <filter string="Opérateur" name="usager" domain="[]"
                                context="{'group_by':'usager'}"/>
                        <separator/>
                        <filter string="Année" name="annee" domain="[]"
                                context="{'group_by':'annee'}"/>
                        <filter string="Mois" name="mois" domain="[]"
                                context="{'group_by':'mois'}"/>
                        <separator/>
                        <filter string="Aérodrome" name="aerodrome" domain="[]"
                                context="{'group_by':'code_aerodrome'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="facture_globale_calendar_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.calendar</field>
            <field name="model">manureva.facture_globale</field>
            <field name="arch" type="xml">
                <calendar string="Analyse des redevances"
                          date_start="date_debut"
                          color="usager"
                          mode="year"
                          quick_add="False"
                          scales="month,year"
                          event_open_popup="False"
                          form_view_id="facture_globale_form_view"
                >
                    <field name="usager" filters="1"/>
                    <field name="nom_aerodrome" filters="1"/>
                    <field name="type_aeronef_code" filters="1"/>
                    <field name="atterissage" type="measure"/>
                    <field name="balisage" type="measure"/>
                    <field name="passagers" type="measure"/>
                    <field name="montant_total" type="measure"/>
                </calendar>
            </field>
        </record>

        <record id="facture_globale_graph_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.graph</field>
            <field name="model">manureva.facture_globale</field>
            <field name="arch" type="xml">
                <graph string="Analyse des redevances" type="bar" stacked="1" sample="1" order="montant_total desc">
                    <field name="annee" type="measure" invisible="1"/>
                    <field name="mois" type="measure" invisible="1"/>
                    <field name="taux_normal" type="measure" invisible="1"/>
                    <field name="taux_reduit" type="measure" invisible="1"/>
                    <field name="code_aerodrome"/>
                    <field name="type_aeronef_code"/>
                    <field name="usager"/>
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="atterissage" type="measure"/>
                    <field name="balisage" type="measure"/>
                    <field name="passagers" type="measure"/>
                    <field name="montant_total" type="measure"/>
                </graph>
            </field>
        </record>

        <record id="facture_globale_pivot_view" model="ir.ui.view">
            <field name="name">manureva.facture_globale.pivot</field>
            <field name="model">manureva.facture_globale</field>
            <field name="arch" type="xml">
                <pivot string="Analyse des redevances" sample="1">
                    <field name="usager" type="row"/>
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="code_aerodrome" type="col"/>
                    <field name="atterissage" type="measure"/>
                    <field name="balisage" type="measure"/>
                    <field name="passagers" type="measure"/>
                    <field name="annee" type="measure" invisible="1"/>
                    <field name="mois" type="measure" invisible="1"/>
                    <field name="taux_normal" type="measure" invisible="1"/>
                    <field name="taux_reduit" type="measure" invisible="1"/>
                </pivot>
            </field>
        </record>

        <record id="facture_globale_act_window" model="ir.actions.act_window">
            <field name="name">Facture globale</field>
            <field name="res_model">manureva.facture_globale</field>
            <field name="view_mode">tree,graph,pivot,form,calendar</field>
            <field name="context">{"search_default_annee_glissante":1}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Factures globales.
                </p>
            </field>
        </record>

        <menuitem name="Facture globale"
                  id="facture_globale_menu"
                  parent="menu_facturation"
                  action="facture_globale_act_window"
                  sequence="50"
        />

</odoo>