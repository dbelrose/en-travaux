<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <record id="periode_form_view" model="ir.ui.view">
            <field name="name">manureva.periode.form</field>
            <field name="model">manureva.periode</field>
            <field name="arch" type="xml">
                <form string="Période" create="0" edit="0" delete="0">
                    <sheet>
                        <header>
                            <button name="facturer_periode"
                                    string="Facturer la période"
                                    class="oe_highlight"
                                    type="object"
                                    groups="manureva.group_manureva_manager"
                                    icon="fa-cogs"
                                    states="1a_facturer"
                            />
<!--                            <button name="imprimer_la_periode"-->
<!--                                    string="Lettre d'accompagnement"-->
<!--                                    type="object"-->
<!--                                    class="btn btn-primary"-->
<!--                                    icon="fa-print"-->
<!--                                    states="2facture"-->
<!--                            />-->
<!--                            <button name="imprimer_fg_periode"-->
<!--                                    string="Facture globale"-->
<!--                                    type="object"-->
<!--                                    class="btn btn-primary"-->
<!--                                    icon="fa-print"-->
<!--                                    states="3la_imprime"-->
<!--                            />-->
<!--                            <button name="imprimer_facture_periode"-->
<!--                                    string="Factures détaillées"-->
<!--                                    type="object"-->
<!--                                    class="btn btn-primary"-->
<!--                                    icon="fa-print"-->
<!--                                    states="4fg_imprime"-->
<!--                            />-->
<!--                            <button name="imprimer_la_periode"-->
<!--                                    string="Lettre d'accompagnement"-->
<!--                                    type="object"-->
<!--                                    icon="fa-print"-->
<!--                                    states="3la_imprime,4fg_imprime,5imprime"-->
<!--                            />-->
<!--                            <button name="imprimer_fg_periode"-->
<!--                                    string="Facture globale"-->
<!--                                    type="object"-->
<!--                                    icon="fa-print"-->
<!--                                    states="4fg_imprime,5imprime"-->
<!--                            />-->
<!--                            <button name="imprimer_facture_periode"-->
<!--                                    string="Factures détaillées"-->
<!--                                    type="object"-->
<!--                                    icon="fa-print"-->
<!--                                    states="5imprime"-->
<!--                            />-->
                            <button name="supprimer_facture_periode"
                                    string="Supprimer les factures"
                                    class="btn-danger"
                                    type="object"
                                    groups="manureva.group_manureva_manager"
                                    icon="fa-trash"
                                    states="2facture,3la_imprime,4fg_imprime,5imprime"
                            />
                            <field name="state"
                                   widget="statusbar"
                                   statusbar_visible="1a_facturer,2facture,3la_imprime,4fg_imprime,5imprime"
                            />
                        </header>
                        <div class="oe_title">
                            <label for="name"/>
                            <h1>
                                <field name="name" placeholder="Title"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="usager_id"/>
                            </group>
                            <group>
                                <field name="annee"/>
                                <field name="mois"/>
<!--                                <field name="a_facturer" readonly="True"/>-->
<!--                                <field name="facture" readonly="True"/>-->
                            </group>
                        </group>
                        <notebook>
                            <page name="factures" string="Factures">
                                <group>
                                    <field name="facture_ids" nolabel="1">
                                        <tree string="Factures">
                                            <field name="name"/>
                                            <field name="facture"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_periode" model="ir.ui.view">
            <field name="name">manureva.periode.tree</field>
            <field name="model">manureva.periode</field>
            <field name="arch" type="xml">
                <tree string="Périodes" create="0" edit="0" delete="0">
                    <field name="name"/>
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="usager_id"/>
                    <field name="state"/>
                    <button name="facturer_periode"
                            string="Facturer la période"
                            class="oe_highlight"
                            type="object"
                            groups="manureva.group_manureva_manager"
                            icon="fa-cogs"
                            states="1a_facturer"
                    />
<!--                    <button name="imprimer_la_periode"-->
<!--                            string="Lettre d'accompagnement"-->
<!--                            type="object"-->
<!--                            class="btn btn-primary"-->
<!--                            icon="fa-print"-->
<!--                            states="2facture"-->
<!--                    />-->
<!--                    <button name="imprimer_fg_periode"-->
<!--                            string="Facture globale"-->
<!--                            type="object"-->
<!--                            class="btn btn-primary"-->
<!--                            icon="fa-print"-->
<!--                            states="3la_imprime"-->
<!--                    />-->
<!--                    <button name="imprimer_facture_periode"-->
<!--                            string="Factures détaillées"-->
<!--                            type="object"-->
<!--                            class="btn btn-primary"-->
<!--                            icon="fa-print"-->
<!--                            states="4fg_imprime"-->
<!--                    />-->
                </tree>
            </field>
        </record>

        <record id="periode_kanban_view" model="ir.ui.view">
            <field name="name">manureva.periode.kanban</field>
            <field name="model">manureva.periode</field>
            <field name="arch" type="xml">
                <kanban string="Périodes" default_group_by="state" archivable="0" quick_create="0" create="0"
                        group_create="0"
                        group_edit="0"
                        group_delete="0"
                >
                    <field name="name"/>
                    <field name="annee"/>
                    <field name="mois"/>
                    <field name="usager_id"/>
                    <field name="state"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div style="position: relative" class="oe_kanban_global_click">
                                <div class="oe_module_vignette">
                                    <div class="oe_module_desc o_kanban_record_title">
                                        <h4 class="card-title">
                                            <field name="name"/>
                                        </h4>
                                        <br/>
                                        <button t-if="record.state.raw_value === '1a_facture'"
                                                name="facturer_periode"
                                                class="btn btn-primary fa fa-cogs"
                                                type="object"
                                                groups="manureva.group_manureva_manager"
                                        > Facturer la période</button>
<!--                                        <button t-if="record.state.raw_value === '2facture'"-->
<!--                                                name="imprimer_la_periode"-->
<!--                                                type="object"-->
<!--                                                class="btn btn-primary fa fa-print"-->
<!--                                        > Lettre d'accompagnement</button>-->
<!--                                        <button t-if="record.state.raw_value === '3la_imprime'"-->
<!--                                                name="imprimer_fg_periode"-->
<!--                                                type="object"-->
<!--                                                class="btn btn-primary fa fa-print"-->
<!--                                        > Facture globale</button>-->
<!--                                        <button t-if="record.state.raw_value === '4fg_imprime'"-->
<!--                                                name="imprimer_facture_periode"-->
<!--                                                type="object"-->
<!--                                                class="btn btn-primary fa fa-print"-->
<!--                                        > Factures détaillées</button>-->
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="periode_search_view" model="ir.ui.view">
            <field name="name">manureva.periode.search</field>
            <field name="model">manureva.periode</field>
            <field name="arch" type="xml">
                <search string="Périodes">
                    <field name="name"/>
                    <field name="usager_id"/>
                    <field name="annee"/>
                    <field name="mois"/>
<!--                    <filter string="A récupérer" name="a_recuperer" domain="[('a_recuperer', '=', True)]"/>-->
                    <filter string="A facturer" name="a_facturer" domain="[('state', '=', '1a_facturer')]"/>
                    <filter string="Facturé" name="facture" domain="[('state', '=', '2facture')]"/>
                    <separator/>
<!--                    <filter string="Lettre imprimée" name="3la_imprime" domain="[('state', '=', '3la_imprime')]"/>-->
<!--                    <filter string="Facture globale imprimée" name="4fg_imprime" domain="[('state', '=', '4fg_imprime')]"/>-->
<!--                    <filter string="Imprimé en totalité" name="5imprime" domain="[('state', '=', '5imprime')]"/>-->
<!--                    <separator/>-->
                    <filter name="annee_en_cours"
                            string="Année calendaire en cours"
                            domain="[('annee', '=', context_today().strftime('%Y'))]" />
                    <filter name="annee_precedente"
                            string="Année calendaire précédente"
                            domain="[('annee', '=', (context_today() + relativedelta(years=-1)).strftime('%Y'))]" />
                    <filter name="annee_glissante"
                            string="Année glissante"
                            domain="[('date_debut', '&gt;=', (context_today() - datetime.timedelta(days=365)).strftime('%%Y-%%m-%%d'))]"/>
                    <group expand="1" string="Group By">
                        <filter string="Opérateur" name="usager_id" domain="[]"
                                context="{'group_by':'usager_id'}"/>
                        <separator/>
                        <filter string="Année" name="annee" domain="[]"
                                context="{'group_by':'annee'}"/>
                        <filter string="Mois" name="mois" domain="[]"
                                context="{'group_by':'mois'}"/>
                        <separator/>
                        <filter string="Etat" name="state" domain="[]"
                                context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_periode" model="ir.actions.act_window">
            <field name="name">Périodes</field>
            <field name="res_model">manureva.periode</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="context">{"search_default_annee_glissante":1}</field>
            <field name="domain">[]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">Les périodes de facturation apparaîtront ici
                </p>
            </field>
        </record>

    	<menuitem 	id="menu_periode"
					parent="menu_facturation"
					name="Périodes"
					action="action_periode"
                     sequence="10"
        />

</odoo>