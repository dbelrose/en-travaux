<odoo>
    <data>
        <record id="view_billetweb_payout_form" model="ir.ui.view">
            <field name="name">billetweb.payout.form</field>
            <field name="model">billetweb.payout</field>
            <field name="arch" type="xml">
                <form string="Virement BilletWeb">
                    <sheet>
                        <group>
                            <field name="payout_id"/>
                            <field name="date"/>
                            <field name="amount"/>
                            <field name="currency_id"/>
                            <field name="partner_id"/>
                            <field name="bank_account_id"/>
                            <field name="imported_payment_id"/>
                        </group>
                        <group>
                            <field name="invoice_ids" context="{'default_move_type': 'out_invoice'}">
                                <tree editable="bottom">
                                    <field name="name"/>
                                    <field name="invoice_date"/>
                                    <field name="amount_total"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_billetweb_payout_kanban" model="ir.ui.view">
            <field name="name">billetweb.payout.kanban</field>
            <field name="model">billetweb.payout</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_small_column">
                    <field name="payout_id"/>
                    <field name="amount"/>
                    <field name="partner_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_title">
                                    <strong><field name="payout_id"/></strong>
                                </div>
                                <div><field name="partner_id"/></div>
                                <div><field name="amount"/> <field name="currency_id"/></div>
                                <div><small><field name="date"/></small></div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_billetweb_payout_tree" model="ir.ui.view">
            <field name="name">billetweb.payout.tree</field>
            <field name="model">billetweb.payout</field>
            <field name="arch" type="xml">
                <tree string="Virements BilletWeb">
                    <field name="payout_id"/>
                    <field name="date"/>
                    <field name="partner_id"/>
                    <field name="amount"/>
                    <field name="bank_account_id"/>
                    <field name="imported_payment_id"/>
                </tree>
            </field>
        </record>


        <record id="action_billetweb_payouts" model="ir.actions.act_window">
            <field name="name">Virements BilletWeb</field>
            <field name="res_model">billetweb.payout</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aucune donnée encore importée depuis BilletWeb.
                </p>
            </field>
        </record>

        <!-- Form View -->
        <record id="view_billetweb_payout_detail_form" model="ir.ui.view">
            <field name="name">billetweb.payout.detail.form</field>
            <field name="model">billetweb.payout.detail</field>
            <field name="arch" type="xml">
                <form string="Détail Virement BilletWeb">
                    <sheet>
                        <group>
                            <field name="ext_id"/>
                            <field name="event"/>
<!--                            <field name="quantity"/>-->
                        </group>
                        <group>
                            <field name="price"/>
                            <field name="fees"/>
                            <field name="tax_rate"/>
                            <field name="tax_amount"/>
                        </group>
                        <group>
                            <field name="payout_id"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree View -->
<!--        <record id="view_billetweb_payout_detail_tree" model="ir.ui.view">-->
<!--            <field name="name">billetweb.payout.detail.tree</field>-->
<!--            <field name="model">billetweb.payout.detail</field>-->
<!--            <field name="arch" type="xml">-->
<!--                <tree editable="false">-->
<!--                    <field name="payout_id"/>-->
<!--                    <field name="ext_id"/>-->
<!--                    <field name="event"/>-->
<!--                    <field name="date"/>-->
<!--                    <field name="price"/>-->
<!--                    <field name="fees"/>-->
<!--                    <field name="tax_rate"/>-->
<!--                    <field name="tax_amount"/>-->
<!--                </tree>-->
<!--            </field>-->
<!--        </record>-->

        <!-- Search View -->
        <record id="view_billetweb_payout_detail_search" model="ir.ui.view">
            <field name="name">billetweb.payout.detail.search</field>
            <field name="model">billetweb.payout.detail</field>
            <field name="arch" type="xml">
                <search>
                    <field name="ext_id"/>
                    <field name="event"/>
                    <filter name="this_month" string="Ce mois-ci"
                        domain="[
                            ('payout_id.date', '>=', (context_today().replace(day=1)).strftime('%Y-%m-%d')),
                            ('payout_id.date', '&lt;', (context_today().replace(day=1) + relativedelta(months=1)).strftime('%Y-%m-%d'))
                        ]"
                        context="{'group_by': 'event'}"
                    />
                </search>
            </field>
        </record>

        <!-- Action -->
        <record id="action_billetweb_payout_detail" model="ir.actions.act_window">
            <field name="name">Détails BilletWeb</field>
            <field name="res_model">billetweb.payout.detail</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_billetweb_payout_detail_search"/>
            <field name="context">
                {
                    'search_default_this_month': 1,
                    'group_by': 'event',
                    'orderby': 'date desc'
                }
            </field>
            <field name="domain">[]</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aucun détail trouvé.
                </p>
                <p>Les lignes de détail des versements BilletWeb s'afficheront ici après importation.</p>
            </field>
        </record>

        <menuitem id="menu_billetweb"
                  name="BilletWeb"
                  parent="account.menu_finance"
                  sequence="60"/>

        <menuitem id="menu_billetweb_payouts"
                  name="Virements importés"
                  parent="menu_billetweb"
                  action="action_billetweb_payouts"/>

        <menuitem id="menu_billetweb_details"
                  name="Détails des ventes"
                  parent="menu_billetweb"
                  action="action_billetweb_payout_detail"
                  sequence="20"/>
    </data>
</odoo>