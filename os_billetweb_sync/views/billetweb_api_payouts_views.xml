<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue Tree pour billetweb.api.payouts -->
    <record id="view_billetweb_api_payouts_tree" model="ir.ui.view">
        <field name="name">billetweb.api.payouts.tree</field>
        <field name="model">billetweb.api.payouts</field>
        <field name="arch" type="xml">
            <tree string="Payouts BilletWeb" default_order="date desc">
                <field name="payout_id"/>
                <field name="date"/>
                <field name="amount" sum="Total" widget="monetary"/>
                <field name="account"/>
                <field name="iban"/>
                <field name="api_user"/>
                <field name="api_call_id"/>
            </tree>
        </field>
    </record>

    <!-- Vue Form pour billetweb.api.payouts -->
    <record id="view_billetweb_api_payouts_form" model="ir.ui.view">
        <field name="name">billetweb.api.payouts.form</field>
        <field name="model">billetweb.api.payouts</field>
        <field name="arch" type="xml">
            <form string="Payout BilletWeb">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="payout_id" placeholder="ID du Payout"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Informations du Payout">
                            <field name="date"/>
                            <field name="amount" widget="monetary"/>
                            <field name="api_user"/>
                            <field name="api_call_id"/>
                        </group>
                        <group string="Informations bancaires">
                            <field name="account"/>
                            <field name="iban"/>
                            <field name="swift"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Données brutes" invisible="raw_data == False">
                            <field name="raw_data" widget="ace" nolabel="1"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue Search pour billetweb.api.payouts -->
    <record id="view_billetweb_api_payouts_search" model="ir.ui.view">
        <field name="name">billetweb.api.payouts.search</field>
        <field name="model">billetweb.api.payouts</field>
        <field name="arch" type="xml">
            <search string="Rechercher dans les payouts">
                <field name="payout_id" string="ID Payout"/>
                <field name="account" string="Compte"/>
                <field name="iban" string="IBAN"/>
                <field name="api_user" string="Utilisateur"/>
                <field name="api_call_id" string="Appel API"/>

                <!-- Filtres -->
                <filter name="filter_current_month" string="Ce mois"
                        domain="[('date', '>=', context_today().strftime('%Y-%m-01'))]"/>
                <filter name="filter_last_month" string="Mois dernier"
                        domain="[('date', '>=', (context_today().replace(day=1) + relativedelta(months=-1)).strftime('%Y-%m-%d')),
                                 ('date', '&lt;', context_today().strftime('%Y-%m-01'))]"/>
                <filter name="filter_has_amount" string="Avec montant" domain="[('amount', '>', 0)]"/>

                <separator/>

                <!-- Groupes -->
                <group expand="0" string="Grouper par">
                    <filter name="group_user" string="Utilisateur" context="{'group_by': 'api_user'}"/>
                    <filter name="group_account" string="Compte" context="{'group_by': 'account'}"/>
                    <filter name="group_date" string="Date" context="{'group_by': 'date:month'}"/>
                    <filter name="group_api_call" string="Appel API" context="{'group_by': 'api_call_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action pour billetweb.api.payouts -->
    <record id="action_billetweb_api_payouts" model="ir.actions.act_window">
        <field name="name">Payouts BilletWeb</field>
        <field name="res_model">billetweb.api.payouts</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_billetweb_api_payouts_search"/>
        <field name="context">{'search_default_filter_current_month': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Aucun payout enregistré
            </p>
            <p>
                Les payouts représentent les versements effectués par BilletWeb.
                Ces données sont synchronisées via l'API et mises en cache localement.
            </p>
        </field>
    </record>
</odoo>